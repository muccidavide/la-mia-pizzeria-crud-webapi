@{

    ViewData["Title"] = "Home Page";
    Layout = "_MyLayout";

}

<div class="text-center m-auto">
    <h1>Pizzeria da Davide</h1>
    <div>
        <input type="text" class="input-form js_search" placeholder="Cerca un pizza" />
    </div>
    <div class="js_loading">Loading...</div>
    <div class="js_no_pizza d-none">
    </div>
    <div class="js_pizza_table text-center m-auto row row-cols-1 row-cols-md-2 row-cols-lg-3">
    </div>
</div>

<script type="text/javascript">

    getPizza("");

    var searchtimer;

        document.querySelector(".js_search").addEventListener("input", (e) => {
            clearTimeout(searchtimer); 
            let title = e.target.value;
            
            searchtimer = setTimeout(() => {

                getPizza(title);
            }, 1000);
        });

    function getPizza(title) {

        axios.get('/api/pizza/', {
            params: {
                title: title
            }
        }).then(
            result => {
                console.log(result);

                document.querySelector('.js_loading').classList.add('d-none');
                if (result.data.length == 0) {
                    document.querySelector('.js_no_pizza').classList.remove('d-none');
                    document.querySelector('.js_pizza_table').classList.add('d-none');
                }
                document.querySelector('.js_no_pizza').classList.add('d-none');
                document.querySelector('.js_pizza_table').innerHTML = '';

                result.data.forEach(pizza => {

                    var url = '@Html.Raw(@Url.Action("Details", "Home"))/' + pizza.pizzaId;
                    //var url = '/menu/pizza/'+ pizza.pizzaId;

                    console.log('pizza', pizza);
                    document.querySelector('.js_pizza_table').innerHTML +=
                        `<div class="p-3">
                                  <a href="${url}" >
                                 <div class="pizza_menu card col mb-3  p-2 ">

                               <img class="card-img-top" width="100" src="${pizza.image}" />

                                <div class="card-body text-black">
                                    <h4 class="fw-bold">${pizza.name}</h4>
                                    <p>${pizza.price} €</p>

                                    </div>
                            </div>
                                 </a>
                                </div>
                                `;
                })
            }
        ).catch(
            error => {
                console.log(error)
            }
        )


    }


</script>